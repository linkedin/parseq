language: java
jdk:
  - oraclejdk8

# Anything after trusty doesn't have Java 8
dist: trusty

# Below skips the installation step completely (https://docs.travis-ci.com/user/customizing-the-build/#Skipping-the-Installation-Step)
# If we don't skip it Travis runs unnecessary Gradle tasks like './gradlew assemble'
install: true

# Build and test commits to master, PRs to master, and release tags
script: ./gradlew -Prelease build
branches:
  only:
  - master
  - /^v\d+\.\d+\.\d+$/

# Set environment variables (includes JFrog credentials)
env:
  global:
    - secure: "XqrufI5VyCfSmaSknN2LjbkWHbB8aO/j3ubahNYoKdd6k9AihFhYbLT419a+4AaQRc5L6VmDcSQyvbFk5ueffGqqSF/k+yrajw/Ghiti+3fSouS/2t09HTos4DiR1xU5xJNE8Mi9jQ+5XNCDzdl9hW5xhB3XzyeGbi9D/8M2Zl0lj5rz9pEevCIKS4G1jV5LJE2mbuQTjrrDI6iFlTKDg1K/R7TIxAL0FGfkM0hVn5p4Mg/s2+3o67k4LSK5qCGK8F6MpwMD6ShPPrAeRqoxiE6FHHqr7TR9uLNb7AeD5zR+YSWexw938VstQEFzsDs2Fr1v1y3Y6Uly+s3bel84TiZBn/Okfw47eo7pevTomoKROziJ9sgX+w33nWsHgRdtLvHBmeTbuPnjlpFgwbPKCK3ROu/Mlp6fvk/MbdH3K0apIZz89XPMPgM13+x0UyTY1t6Lhr0qEIU8CbpJh8M4B3krgxyTX8BNucCqTiPpUXCWmZL5+HK2f9Qx1XfvMnWWa1ckcc09gsYzvLVLUEqZvEiiUko+ldzWJ92zrb02xQsaIFLC6jewI2gEcolb7SYU3d/oadcC6jS7ehyEOkv21SvRPtUAjUZNDubRhqPtm6YHhzj+zvZ2NYHLVZUuheGO1X37YAeZmEnJFMx6i6f7mH+ZdP4MlaMcp1TRpRlK5vA="
    - secure: "sBC8EHpA09m96IXdFOciyeqCbBytnAfsxWikPIO//iztFznOSEqP5+ELorLDDUnNZgL0gqu1ps8YsC6ZuNdrXOTm4OIuUXlyfd9W3NDgoTeY6u7Dej7UGBolWKW3pZa0yePkpCiE9pz8nshTP9vFU7OqK6brtn83PoIEgk/lDBTx8GjKvU1epMC/vr+p5A0osvoSIvnZXQGGK6bwmXnXUQ6Xh4t6ai9NxPo55SSRKIAup5W0CGanS++EvcOG9y7YT2S01WDaff5W2yFgw8VzWPX7k6UICkYXZC2lDBgwnf/C2QeIkfjD2bpjWMkbHLXL8RpXZ9awtVRVZfeqag8Mg/TbQqiuybJO46qpcSruFyYT5zWK97uaLnlThkjo7BSUT6J/EY1AaKGgSEWZki5mOjr/64rkxcA66h7n7h/c4G5pINWF6sr3XBCuYAv+/QS7+0P5rE4Y2BkYsaihynRc8xDXbJrC9/tNN1BvN0Ewq9EuIN33uuaQ4JmZASknl2gXRfXCBNe2NlBtJTsItnqGBh/KqGLT1J75srqsX91FGlVzMSXGiAtbhsdqk+FfMJEssXQ4FcDm39y6M3gvjp2PNmIpuUHGfUwDrA+9bKEYg0ad+9fqgZMuBvwQDrqf1rHtaNaLKKBM5d9HCNJZrvKR3PYDG+te5ic3l+pxzE8Z45c="

# Publish a new version on tag push
deploy:
  provider: script
  script: scripts/travis/publish-tag.sh
  on:
    tags: true
  # Without this, build artifacts will be cleaned up before deployment
  skip_cleanup: true

# Send email notifications to the user associated with a tag deployment
notifications:
  email:
    if: tag IS present
    on_failure: always
    on_success: always
